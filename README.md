# Operation Management - iPhone需要予測システム

## Overview
このリポジトリは、iPhone売上データの高度な分析と機械学習ベースの需要予測を行うエンタープライズグレードのシステムです。S&OP（Sales & Operations Planning）、生産計画、在庫最適化の意思決定を支援します。

## プロジェクト内容

### 🎯 ビジネス目的
- **S&OP需要計画**: 国/チャネル/モデル別の月次需要計画
- **生産・調達最適化**: M+3～M+6の部材発注計画
- **在庫配置**: 新機種ローンチと旧機種EOL在庫の最適化
- **販促投資配分**: 価格・プロモーション施策の効果予測

### 📊 成功基準
- 主要国×月のMAPE ≤ 12%（発売月を除く）
- 新機種ローンチ±2か月のWAPE ≤ 18%
- 需要欠品率（予測起因）▲30%削減

## 予測システムの特徴

### 🚀 高度なモデリング
1. **機械学習アプローチ**: LightGBM勾配ブースティング
2. **豊富な特徴量**:
   - ライフサイクル分析（発売後経過期間、成長段階）
   - 季節性・カレンダー効果（祝日、セール期間、Q4効果）
   - 価格弾力性シミュレーション
   - プロモーション強度指標
   - 移動平均・ラグ特徴量
3. **高精度**: 訓練データでMAPE 1.94%、WAPE 1.70%を達成
4. **シナリオシミュレーション**: 価格/プロモ/供給制約の影響分析

### 📈 予測結果（iPhone 16）

#### ベースライン予測
- **予測期間**: 2024年9月〜2025年6月（初年度10ヶ月）
- **総予測売上**: 134.69百万台
- **モデル性能**: MAPE 1.88% (iPhone 15検証)

#### シナリオ分析
| シナリオ | 予測売上 | ベース比 | ビジネスインパクト |
|---------|---------|---------|------------------|
| ベースライン | 134.69 M | - | 通常需要 |
| 価格-5% | 142.75 M | +6.0% | 弾力性1.2を想定 |
| プロモ+1レベル | 145.46 M | +8.0% | キャンペーン強化 |
| 供給制約-20% | 107.75 M | -20.0% | 在庫不足影響 |

#### 月別予測（ベースライン）
| 年月 | 予測売上（百万台） | ライフサイクル段階 |
|------|-------------------|------------------|
| 2024年9月 | 12.55 | Launch |
| 2024年10月 | 18.26 | Launch |
| 2024年11月 | 17.84 | Launch |
| 2024年12月 | 18.76 | Growth (Holiday) |
| 2025年1月 | 10.67 | Growth |
| 2025年2月 | 11.25 | Growth |
| 2025年3月 | 12.70 | Growth |
| 2025年4月 | 9.91 | Mature |
| 2025年5月 | 10.83 | Mature |
| 2025年6月 | 11.92 | Mature |

### 📊 過去実績比較
| モデル | 初年度実績 | YoY成長率 | MAPE (検証) |
|--------|-----------|----------|-------------|
| iPhone 12 | 189.09 M | - | 2.00% |
| iPhone 13 | 149.11 M | -21.14% | 1.95% |
| iPhone 14 | 148.66 M | -0.31% | 1.95% |
| iPhone 15 | 156.33 M | +5.16% | 1.88% |
| **iPhone 16 (予測)** | **134.69 M** | **-13.8%** | **-** |

## ファイル構成

### 📁 ドキュメント
- **`requirements_document.md`** - 包括的な要件定義書
  - ビジネス目的、成功基準
  - データ要件とデータ辞書
  - モデル方針と評価指標
  - 運用要件とMLOps
  - シナリオ設計

- **`CLAUDE.md`** - リポジトリガイダンス
- **`README.md`** - 本ドキュメント

### 📊 データファイル
- **`Iphone_Sales_Data(1).csv`** - 実績データ
  - iPhone 12〜16の日次売上（2020年10月〜2025年6月）
  - 2,490レコード、5モデル

### 🔧 分析スクリプト

#### ベースライン予測
- **`iphone16_forecast.py`** - シンプルな時系列予測
  - 月次集計と平均パターン分析
  - iPhone 15ベースライン + 3%成長
  - Excel出力（4シート）

#### 高度な予測システム（推奨）
- **`advanced_forecast_model.py`** - エンタープライズグレード予測
  - LightGBM機械学習モデル
  - 18個の特徴量エンジニアリング
  - 時系列クロスバリデーション
  - シナリオシミュレーター
  - 包括的な評価指標（MAPE/WAPE/Bias）
  - Excel出力（6シート）

### 📈 出力ファイル

#### ベースライン出力
- **`iPhone16_Sales_Forecast.xlsx`**
  - iPhone16_Forecast: 月別予測
  - Historical_Comparison: 世代間比較
  - Summary: 統計サマリー
  - Historical_Monthly_Data: 元データ

#### 高度なモデル出力（推奨）
- **`iPhone_Advanced_Forecast_Output.xlsx`**
  - Monthly_Forecast_Scenarios: 月別予測 + 3シナリオ
  - Model_Performance: MAPE/WAPE/Bias評価
  - Feature_Importance: 重要特徴量ランキング
  - Daily_Forecast_Detail: 日次詳細（90日分）
  - Historical_Validation: 実績vs予測検証
  - Executive_Summary: エグゼクティブサマリー

## 使用方法

### 📦 必要なライブラリ

#### ベースラインモデル
```bash
pip install pandas numpy openpyxl
```

#### 高度なモデル（推奨）
```bash
pip install pandas numpy openpyxl lightgbm scikit-learn
```

### ▶️ 実行方法

#### ベースライン予測
```bash
python3 iphone16_forecast.py
```
→ `iPhone16_Sales_Forecast.xlsx`が生成されます

#### 高度な予測システム（推奨）
```bash
python3 advanced_forecast_model.py
```
→ `iPhone_Advanced_Forecast_Output.xlsx`が生成されます

### 📊 出力の活用

1. **S&OP計画**: Monthly_Forecast_Scenariosシートを使用
2. **モデル信頼性確認**: Model_Performanceシートでセグメント別精度を確認
3. **要因分析**: Feature_Importanceシートで需要ドライバーを把握
4. **シナリオ分析**: 価格/プロモ/供給制約の影響を比較
5. **日次オペレーション**: Daily_Forecast_Detailで短期計画を立案

## モデルの詳細

### 特徴量設計（18個）

#### 時系列特徴
- 月、四半期、曜日、週番号
- 発売後経過日数/週数/月数
- 7日・30日移動平均
- 7日・30日ラグ

#### ビジネス特徴
- ライフサイクル段階（Launch/Growth/Mature/Decline）
- 季節性（Q4、ホリデーシーズン、新学期）
- 価格シミュレーション（ライフサイクル連動減価）
- プロモーション強度（ブラックフライデー、セール期間）
- 新機種発売影響フラグ
- モデル世代番号

### 評価指標

| 指標 | 全体 | iPhone 12 | iPhone 13 | iPhone 14 | iPhone 15 |
|------|------|-----------|-----------|-----------|-----------|
| MAPE (%) | 1.94 | 2.00 | 1.95 | 1.95 | 1.88 |
| WAPE (%) | 1.70 | 1.77 | 1.70 | 1.68 | 1.62 |
| MAE (M units) | 0.0060 | - | - | - | - |
| RMSE (M units) | 0.0087 | - | - | - | - |

### 重要特徴量トップ5
1. **Sales_MA7** (7日移動平均) - 需要の短期トレンド
2. **Sales_MA30** (30日移動平均) - 需要の中期トレンド
3. **Month** - 季節性効果
4. **DaysSinceLaunch** - ライフサイクル効果
5. **Quarter** - 四半期効果（Q4ピーク）

## シナリオシミュレーション

### 価格-5%シナリオ
- **想定**: 定価を5%引き下げ
- **弾力性**: -1.2（1%価格減→1.2%需要増）
- **結果**: +6.0%需要増（+8.06 M units）
- **活用**: 粗利vs売上のトレードオフ分析

### プロモ+1レベルシナリオ
- **想定**: プロモーション強度を1段階強化
- **効果**: +8%需要増
- **結果**: +10.77 M units
- **活用**: 販促ROI最適化

### 供給制約-20%シナリオ
- **想定**: 部材不足で供給が20%減
- **結果**: 需要充足率80%、-26.94 M units機会損失
- **活用**: 在庫リスク・欠品コスト分析

## 今後の拡張（ロードマップ）

### フェーズ2: データ拡張
- [ ] 実際の価格・プロモーションデータ統合
- [ ] 在庫・欠品データ連携
- [ ] 国別・チャネル別セグメンテーション
- [ ] 競合データ（発売日、価格）

### フェーズ3: モデル高度化
- [ ] 階層型予測（Top-down/Bottom-up調整）
- [ ] Prophet/SARIMAとのアンサンブル
- [ ] Bayesian更新（予約データからのCold Start改善）
- [ ] 需要抑圧補正（欠品時の潜在需要推定）

### フェーズ4: 運用最適化
- [ ] 自動再学習パイプライン（週次/月次）
- [ ] ダッシュボード開発（国/チャネル/機種ピボット）
- [ ] APIエンドポイント
- [ ] アラート機能（誤差ドリフト検知）

### フェーズ5: 意思決定連携
- [ ] 在庫最適化（サービスレベル×予測分布）
- [ ] 価格最適化（弾力性×在庫×粗利）
- [ ] S&OPコンセンサス形成ワークフロー

## 技術スタック

- **言語**: Python 3.12+
- **データ処理**: pandas, numpy
- **機械学習**: LightGBM, scikit-learn
- **出力**: openpyxl (Excel)
- **将来**: Prophet, statsmodels, plotly (可視化)

## ライセンス・コンプライアンス

- 個人情報なし（集計レベルのみ）
- モデル説明責任（特徴量重要度の可視化）
- 外部データライセンス順守

## 参考資料

- **要件定義**: `requirements_document.md`
- **開発ガイダンス**: `CLAUDE.md`
- **ビジネスコンタクト**: Ops/需要計画チーム

---

**最終更新**: 2024年10月14日
**モデルバージョン**: v2.0 (LightGBM Advanced)
**データバージョン**: 2020-10 ~ 2025-06
